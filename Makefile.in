
srcdir = @srcdir@/src

config = ./src/include/config.h

CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
CXXFLAGS = @CXXFLAGS@ $(CPPFLAGS) -I./src/include -I/opt/gsasl/include
CXX = @CXX@ $(CXXFLAGS)
CC = @CC@ $(CFLAGS)
AR = @AR@
RANLIB = @RANLIB@
INSTALL = @INSTALL@
MKDIR = @MKDIR@
LIBS = @LIBS@ -lgsasl

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includedir = @includedir@

PREFIX = $(DESTDIR)$(prefix)
EPREFIX = $(DESTDIR)$(exec_prefix)
BINDIR = $(DESTDIR)$(bindir)
INCLUDEDIR = $(DESTDIR)$(includedir)
LIBDIR = $(DESTDIR)$(libdir)

INSTALL_BIN = $(INSTALL) -m755
INSTALL_INC = $(INSTALL) -m644
INSTALL_LIB = $(INSTALL) -m644

BUILD = @build@
HOST = @host@
HOST_OS = @host_os@

MAWAR_OBJECTS=xmppserver.o
MAWAR_OBJECTS+=xmppstream.o
MAWAR_OBJECTS+=myconsole.o
MAWAR_OBJECTS+=xml_tag.o
MAWAR_OBJECTS+=attagparser.o
MAWAR_OBJECTS+=tagbuilder.o
MAWAR_OBJECTS+=stanza.o
MAWAR_OBJECTS+=jid.o
MAWAR_OBJECTS+=configfile.o
MAWAR_OBJECTS+=virtualhost.o

.PHONY: all install
maward: $(srcdir)/main.cpp $(MAWAR_OBJECTS)
	$(CXX) $(srcdir)/main.cpp $(MAWAR_OBJECTS) $(LDFLAGS) $(LIBS) -o maward

# modules

xmppserver.o: $(srcdir)/xmppserver.cpp $(srcdir)/include/xmppserver.h
	$(CXX) -c $(srcdir)/xmppserver.cpp -o xmppserver.o

xmppstream.o: $(srcdir)/xmppstream.cpp $(srcdir)/include/xmppstream.h $(srcdir)/include/tagbuilder.h
	$(CXX) -c $(srcdir)/xmppstream.cpp -o xmppstream.o

myconsole.o: $(srcdir)/myconsole.cpp $(srcdir)/include/myconsole.h
	$(CXX) -c $(srcdir)/myconsole.cpp -o myconsole.o

xml_tag.o: $(srcdir)/xml_tag.cpp $(srcdir)/include/xml_tag.h $(srcdir)/include/xml_types.h
	$(CXX) -c $(srcdir)/xml_tag.cpp -o xml_tag.o

attagparser.o: $(srcdir)/attagparser.cpp $(srcdir)/include/attagparser.h
	$(CXX) -c $(srcdir)/attagparser.cpp -o attagparser.o

tagbuilder.o: $(srcdir)/tagbuilder.cpp $(srcdir)/include/tagbuilder.h
	$(CXX) -c $(srcdir)/tagbuilder.cpp -o tagbuilder.o

stanza.o: $(srcdir)/stanza.cpp $(srcdir)/include/stanza.h
	$(CXX) -c $(srcdir)/stanza.cpp -o stanza.o

jid.o: $(srcdir)/jid.cpp $(srcdir)/include/jid.h
	$(CXX) -c $(srcdir)/jid.cpp -o jid.o

configfile.o: $(srcdir)/configfile.cpp $(srcdir)/include/configfile.h
	$(CXX) -c $(srcdir)/configfile.cpp -o configfile.o

virtualhost.o: $(srcdir)/virtualhost.cpp $(srcdir)/include/virtualhost.h $(srcdir)/include/xmppserver.h
	$(CXX) -c $(srcdir)/virtualhost.cpp -o virtualhost.o

# CLEAN

.PHONY: clean distclean

distclean: clean
	rm -f Makefile *.log  $(config) config.status

clean:
	rm -f *.o maward
